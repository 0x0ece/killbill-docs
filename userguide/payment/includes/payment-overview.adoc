Kill Bill is a generic platform to build billing and payment infrastructures and as such, it is agnostic of payment gateways. However, it provides a framework to register payment plugins, which in turn implement gateway specific APIs.

=== Terminology

Throughout this document, we will be using the following terminology:

*E-commerce application/merchant website/client application* - Application that integrates with Kill Bill.

*End-user* - User that uses the e-commerce application

*Payment-related APIs* - Kill Bill APIs that perform payment related operations.

*Payment plugin* - Piece of code that resides within Kill Bill and implements payment gateway specific APIs/interacts with the payment gateway

*Payment gateway/payment provider* - Entity that processes the payment

*Account* - A customer account in Kill Bill corresponding to an end-user.

*Payment Method* - A record of the details required for Kill Bill to trigger a payment. Payment Methods represent things like credit cards, debit cards, or PayPal accounts.  An account can have multiple payment methods corresponding to different payment gateways.

*Payment* - A Kill Bill record that encapsulates charging an end-user against a payment method. It also has a state that indicates whether the underlying transaction was successful or not.


=== How Payment Works

The following diagram provides a high level overview of the payment system in Kill Bill:

image:https://github.com/killbill/killbill-docs/raw/v3/userguide/assets/img/payment-userguide/payment-system-overview.png[align=center]

The Kill Bill payment system consists of Kill Bill's payment related APIs and payment plugins. The Kill Bill APIs can be used by an external e-commerce application (to trigger one-off payments), by the Kill Bill core engine (to process recurring payments) and by https://docs.killbill.io/latest/userguide_kaui.html[Kill Bill Admin UI (Kaui))] (to process refunds, chargebacks, etc). The payment related APIs then interact with the payment gateway via a payment plugin specific to the gateway.

There can be multiple  payment plugins registered with Kill Bill, each of which interacts with a different payment gateway. When the Kill Bill payment system needs to charge a customer or perform some other payment related operation like refund, credit, etc, it detects all the payment plugins registered in the system and decide which plugin to use. 

The dispatching is based on the payment methods associated with each account. By default, the model is to attach a default payment method to each account: that payment method will have a link that points to a specific plugin to use. For instance, one account could have a Paypal payment method that would point to the Paypal plugin. Additionally, you can also override the payment method to use on a per payment call. The figure below shows the relationship between a Kill Bill `Account`, its various `PaymentMethods`, each of which points to a given Kill Bill plugin, which itself is in charge to interact with a third party payment gateway.

image:https://docs.google.com/drawings/d/1ERbfXS0LKSyANT08wnp3zDyoROkhKWSdX2EK0LpwLQ4/pub?w=960&amp;h=480[align=center]

By default Kill Bill does not come configured with any payment plugins except for the built-in __EXTERNAL_PAYMENT__, which is used to track payments which occurred outside of Kill Bill. A typical example would be for when a customer pays by check and we want to make sure the invoice balance is set to 0 after receiving the check. A user, represented in Kill Bill as an account can add as many payment methods as required, and each of those will identify a specific plugin that Kill Bill will use when making payments.


